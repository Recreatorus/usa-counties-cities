(function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self,e.autocomplete=t())})(this,function(){"use strict";function e(e){function t(){var e=x.parentNode;e&&e.removeChild(x)}function n(){b&&window.clearTimeout(b)}function o(){x.parentNode||y.body.appendChild(x)}function i(){return!!x.parentNode}function r(){P++,S=[],z="",L=void 0,t()}function f(){function t(){var e=y.documentElement,t=e.clientTop||y.body.clientTop||0,i=e.clientLeft||y.body.clientLeft||0,r=window.pageYOffset||e.scrollTop,f=window.pageXOffset||e.scrollLeft;n=A.getBoundingClientRect();var l=n.top+A.offsetHeight+r-t,u=n.left+f-i;C.top=l+"px",C.left=u+"px",o=window.innerHeight-(n.top+A.offsetHeight)-250,o<0&&(o=0),C.top=l+"px",C.bottom="",C.left=u+"px",C.maxHeight=o+"px"}if(i()){C.height="auto",C.width=A.offsetWidth+"px";var n,o=0;t(),t(),e.customize&&n&&e.customize(A,n,x,o)}}function l(){for(;x.firstChild;)x.removeChild(x.firstChild);var t=function(e,t){var n=y.createElement("div");return n.textContent=e.label||"",n};e.render&&(t=e.render);var n=function(e,t){var n=y.createElement("div");return n.textContent=e,n};e.renderGroup&&(n=e.renderGroup);var i=y.createDocumentFragment(),l="#9?$";if(S.forEach(function(o){if(o.group&&o.group!==l){l=o.group;var f=n(o.group,z);f&&(f.className+=" group",i.appendChild(f))}var u=t(o,z);u&&(u.addEventListener("click",function(t){e.onSelect(o,A),r(),t.preventDefault(),t.stopPropagation()}),o===L&&(u.className+="selected"),i.appendChild(u))}),x.appendChild(i),S.length<1){if(!e.emptyMsg)return void r();var u=y.createElement("div");u.className="empty",u.textContent=e.emptyMsg,x.appendChild(u)}o(),f(),c()}function u(){i()&&l()}function a(){u()}function s(e){e.target!==x?u():e.preventDefault()}function d(e){for(var t=e.which||e.keyCode||0,n=[38,13,27,39,37,16,17,18,20,91,9],o=0,r=n;o<r.length;o++){var f=r[o];if(t===f)return}t>=112&&t<=123||40===t&&i()||h(0)}function c(){var e=x.getElementsByClassName("selected");if(e.length>0){var t=e[0],n=t.previousElementSibling;if(n&&-1!==n.className.indexOf("group")&&!n.previousElementSibling&&(t=n),t.offsetTop<x.scrollTop)x.scrollTop=t.offsetTop;else{var o=t.offsetTop+t.offsetHeight,i=x.scrollTop+x.offsetHeight;o>i&&(x.scrollTop+=o-i)}}}function p(){if(S.length<1)L=void 0;else if(L===S[0])L=S[S.length-1];else for(var e=S.length-1;e>0;e--)if(L===S[e]||1===e){L=S[e-1];break}}function v(){if(S.length<1&&(L=void 0),L&&L!==S[S.length-1]){for(var e=0;e<S.length-1;e++)if(L===S[e]){L=S[e+1];break}}else L=S[0]}function m(t){var n=t.which||t.keyCode||0;if(38===n||40===n||27===n){var o=i();if(27===n)r();else{if(!o||S.length<1)return;38===n?p():v(),l()}return t.preventDefault(),void(o&&t.stopPropagation())}13===n&&(L&&(e.onSelect(L,A),r()),D&&t.preventDefault())}function g(){F&&h(1)}function h(t){var o=++P,i=A.value;i.length>=M||1===t?(n(),b=window.setTimeout(function(){e.fetch(i,function(e){P===o&&e&&(S=e,z=i,L=S.length<1||H?void 0:S[0],l())},t)},0===t?k:0)):r()}function E(){setTimeout(function(){y.activeElement!==A&&r()},200)}function w(){A.removeEventListener("focus",g),A.removeEventListener("keydown",m),A.removeEventListener(O,d),A.removeEventListener("blur",E),window.removeEventListener("resize",a),y.removeEventListener("scroll",s,!0),n(),r()}var L,b,y=document,x=y.createElement("div"),C=x.style,T=navigator.userAgent,N=-1!==T.indexOf("Firefox")&&-1!==T.indexOf("Mobile"),k=e.debounceWaitMs||0,D=e.preventSubmit||!1,H=e.disableAutoSelect||!1,O=N?"input":"keyup",S=[],z="",M=2,F=e.showOnFocus,P=0;if(void 0!==e.minLength&&(M=e.minLength),!e.input)throw new Error("input undefined");var A=e.input;return x.className="autocomplete "+(e.className||""),C.position="absolute",x.addEventListener("mousedown",function(e){e.stopPropagation(),e.preventDefault()}),x.addEventListener("focus",function(){return A.focus()}),A.addEventListener("keydown",m),A.addEventListener(O,d),A.addEventListener("blur",E),A.addEventListener("focus",g),window.addEventListener("resize",a),y.addEventListener("scroll",s,!0),{destroy:w}}return e});